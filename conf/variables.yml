---

innodb_buffer_pool_size: "{{ memory_db }}"

php_memory_limit: 256 # In MB "256MB ought to be enough for anyone." -Bill Gates

# Following values are highly dependand on server resources so we just calculate suitable values for them here.
php_fpm_pm_max_children: "{{ memory_app // php_memory_limit }}"
php_fpm_pm_start_servers: "{{ php_fpm_pm_max_children|int // 2 }}"
php_fpm_pm_min_spare_servers: "{{ php_fpm_pm_max_children|int // 2 }}"
php_fpm_pm_max_spare_servers: "{{ php_fpm_pm_max_children|int // 2 }}"

nginx_workers: "{{ ansible_processor_vcpus }}" # This should be equal to core count


# PHP version to be used. Available options: php56u, php70u
php_package: "php70u"

# Variables to create/update UpCloud Servers
upcloud_server_hostname_base_domain: fsa.lon.wunder.io
upcloud_project_name: FSA

# These are the specifications for servers in this project
upcloud_server_spec_list:
  - group: stage
    members:
      - { name: web1, state: present }
    settings:
      plan: 2xCPU-2GB
      zone: uk-lon1 #can be de-fra1, fi-hel1 too
      # Allows ansible to reboot the machine when making changes to the disks
      allow_reboot_on_resize: true
      storage_devices:
        - title: root
          size: 50
          os: CentOS 7.0
          backup_rule: { interval: daily, time: '0430', retention: 14 }
        - title: logs
          size: 10
          mount:
            path: /var/log
            fstype: ext4
            opts: noatime
        - title: database
          size: 10
          mount:
            path: /var/lib/mysql
            fstype: ext4
            # Options for mysql performance
            # These are the same as Mozilla is using for their mysql servers: https://bugzilla.mozilla.org/show_bug.cgi?id=874039
            opts: defaults,noatime,data=writeback,barrier=0,dioread_nolock
          backup_rule: { interval: daily, time: '0430', retention: 14 }
